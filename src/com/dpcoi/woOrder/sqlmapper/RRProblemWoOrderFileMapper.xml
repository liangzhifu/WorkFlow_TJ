<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="RRProblemWoOrderFileMapper">

    <sql id="WHERE_SQL">
      <where>
          dor.`DPCOI_ORDER_ID` = dwo.`DPCOI_ORDER_ID`
          AND dwo.`DPCOI_WO_ORDER_ID` = dwof.`DPCOI_WO_ORDER_ID`
          AND dwof.`FILE_ID` = fu.`FILE_ID`
          and dor.`rr_problem_id` = problem.`id`
          AND dor.`DEL_FLAG` = '0'
          AND dwo.`DEL_FLAG` = '0'
          AND dwof.`DEL_FLAG` = '0'
          and dor.`DPCOI_ORDER_TYPE` = 3
      </where>
    </sql>

    <select id="selectRRProblemWoOrderFileListPage" parameterType="RRProblemWoOrderFileQuery" resultType="java.util.HashMap">
        select dor.`DPCOI_ORDER_ID` as dpcoiOrderId,
        dor.`DPCOI_ORDER_STATE` as dpcoiOrderState,
        dor.`DPCOI_ORDER_TYPE` as dpcoiOrderType,
        problem.`problem_status` as problemStatus,
        problem.`problem_no` as problemNo,
        problem.`problem_type` as problemType,
        problem.`product_no` as productNo,
        problem.`engineering`,
        problem.`customer`,
        problem.`vehicle`,
        problem.`bad_content` as badContent,
        problem.`severity`,
        problem.product_no as productNo,
        problem.`product_line` as productLine,
        problem.`reason_for_delay` as reasonForDelay,
        problem.`Speed_of_progress` as speedOfProgress,
        problem.root_cause as rootCause,
        problem.permanent_game as permanentGame,
        fu.`FILE_ID` AS fileId,
        fu.`FILE_NAME` AS fileName,
        fu.`FILe_TYPE` AS fileType,
        fu.`FILE_ALIAS` AS fileAlias,
        fu.`EXCEL_PDF_NAME` as excelPdfName,
        dwo.`DPCOI_WO_ORDER_ID` as dpcoiWoOrderId,
        dwo.`DPCOI_WO_ORDER_STATE` as dpcoiWoOrderState,
        dwo.`DPCOI_WO_ORDER_TYPE` as dpcoiWoOrderType
        FROM dpcoi_order dor, dpcoi_wo_order dwo, dpcoi_wo_order_file dwof, file_upload fu, dpcoi_rr_problem problem
        <include refid="WHERE_SQL"></include>
        order by dor.`DPCOI_ORDER_ID` desc limit #{start},#{size}
    </select>

    <select id="selectRRProblemWoOrderFileCount" parameterType="RRProblemWoOrderFileQuery" resultType="java.lang.Integer">
        select count(1)
        FROM dpcoi_order dor, dpcoi_wo_order dwo, dpcoi_wo_order_file dwof, file_upload fu, dpcoi_rr_problem problem
        <include refid="WHERE_SQL"></include>
    </select>

</mapper>